<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Swipe Survey</title>

<style>
  body {
    margin: 0;
    background: #f4f5f7;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  .card {
    width: 90%;
    max-width: 420px;
    background: #fff;
    border-radius: 24px;
    padding: 40px 24px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.08);
    text-align: center;
  }

  h1 {
    font-size: 26px;
    margin-bottom: 12px;
  }

  .sub {
    color: #666;
    margin-bottom: 16px;
  }

  .instructions {
    font-size: 14px;
    color: #888;
    line-height: 1.6;
    margin-bottom: 20px;
  }

  .status {
    margin-top: 24px;
    font-weight: 600;
    color: #222;
  }
</style>
</head>

<body>

<div class="card" id="card">
  <h1 id="question">How are you feeling today?</h1>
  <div class="sub">Swipe to answer</div>

  <div class="instructions" id="instructions">
    ↑ Better<br>
    → Same<br>
    ↓ Worse<br>
    ← Skip
  </div>

  <div class="status" id="status"></div>
</div>

<script>
/* ================= CONFIG ================= */
const GOOGLE_SCRIPT_URL = "PASTE_YOUR_APPS_SCRIPT_URL_HERE";

/* ================= STATE ================= */
let stage = "Q1";        // Q1 → Q2 → DONE
let locked = false;
let q1 = null;
let q2 = null;

let startX = 0;
let startY = 0;

/* ================= ELEMENTS ================= */
const card = document.getElementById("card");
const question = document.getElementById("question");
const instructions = document.getElementById("instructions");
const status = document.getElementById("status");

/* ================= TOUCH HANDLERS ================= */
card.addEventListener("touchstart", e => {
  if (locked) return;
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
});

card.addEventListener("touchend", e => {
  if (locked) return;

  const dx = e.changedTouches[0].clientX - startX;
  const dy = e.changedTouches[0].clientY - startY;

  if (Math.abs(dx) < 40 && Math.abs(dy) < 40) return;

  let dir;
  if (Math.abs(dx) > Math.abs(dy)) {
    dir = dx > 0 ? "RIGHT" : "LEFT";
  } else {
    dir = dy < 0 ? "UP" : "DOWN";
  }

  if (stage === "Q1") handleQ1(dir);
  else if (stage === "Q2") handleQ2(dir);
});

/* ================= LOGIC ================= */
function handleQ1(dir) {
  q1 = {
    UP: "BETTER",
    RIGHT: "SAME",
    DOWN: "WORSE",
    LEFT: "SKIP"
  }[dir];

  if (!q1) return;

  if (q1 === "SKIP") {
    save("SKIP", "NA");
    return;
  }

  stage = "Q2";

  question.innerText = {
    BETTER: "How much did it improve?",
    SAME: "How stable are you?",
    WORSE: "How bad is it?"
  }[q1];

  instructions.innerHTML = `
    ↑ Slight<br>
    → Moderate<br>
    ↓ Major<br>
    ← Skip detail
  `;
}

function handleQ2(dir) {
  q2 = {
    UP: "SLIGHT",
    RIGHT: "MODERATE",
    DOWN: "MAJOR",
    LEFT: "SKIP_DETAIL"
  }[dir];

  save(q1, q2);
}

function save(a, b) {
  locked = true;
  stage = "DONE";

  instructions.style.display = "none";
  status.innerText = "Saved. Thank you.";

  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      primary: a,
      secondary: b,
      timestamp: new Date().toISOString(),
      device: navigator.userAgent
    })
  }).catch(() => {});
}
</script>

</body>
</html>
