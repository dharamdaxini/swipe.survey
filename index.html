<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>Alchemist | Operator UI v136.31</title>

<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Inter:wght@400;500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
 --bg:#000;
 --card:#121212;
 --border:#333;
 --text-main:#e6e6e6;
 --text-grey:#9a9a9a;
 --accent:#d4af37;
 --font-serif:'Crimson Text',serif;
 --font-sans:'Inter',sans-serif;
 --font-code:'JetBrains Mono',monospace;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
 margin:0;height:100vh;background:var(--bg);
 color:var(--text-main);
 font-family:var(--font-sans);
 overflow:hidden;display:flex;flex-direction:column;
}
#header{width:90%;margin:22px auto 0}
.header-meta{
 display:flex;justify-content:space-between;
 font-family:var(--font-code);
 font-size:.75rem;color:#666;
 letter-spacing:1.5px;text-transform:uppercase;
}
#review-text{
 margin-top:14px;
 font-family:var(--font-serif);
 font-size:1.1rem;
 font-style:italic;
 text-align:center;
 color:#aaa;
 min-height:3.2em;
}
.progress-track{width:100%;height:3px;background:#222;margin-top:12px;border-radius:2px}
#progress-bar{height:100%;background:#666;width:0%}
#stack{
 position:relative;width:90%;max-width:420px;height:62vh;
 margin:auto;perspective:1500px;
 display:flex;align-items:center;justify-content:center;
}
.card{
 position:absolute;width:100%;height:95%;
 background:#121212;border-radius:14px;border:1px solid #333;
 padding:36px;display:flex;justify-content:center;align-items:center;
 box-shadow:0 20px 60px rgba(0,0,0,.95);
}
.card-q{
 font-family:var(--font-serif);
 font-size:1.4rem;line-height:1.55;font-weight:600;
 text-align:center;color:#e6e6e6;width:100%;
 opacity:0;transform:translateY(10px);
 transition:.35s;
}
.card-q.show{opacity:1;transform:none}
.swipe-label{
 position:absolute;inset:0;
 display:flex;align-items:center;justify-content:center;
 font-weight:700;font-size:1.5rem;
 color:#9a9a9a;opacity:0;
}
.swipe-label.active{opacity:1}
</style>
</head>

<body>

<div id="header">
 <div class="header-meta">
  <span id="id-ui">BOOT</span>
  <span id="xp-ui">0 XP</span>
 </div>
 <div id="review-text"></div>
 <div class="progress-track"><div id="progress-bar"></div></div>
</div>

<div id="stack"></div>

<script>
const MASTER_KEY="ALCHEMIST_MASTER_V1";

let RAW_DATA=[],POOL=[],WRONG=[],REVIEW_POOL=[];
let SESSION_ALL=[],XP=0,IDX=0,CURR=null;
let QUESTION_LIMIT=null;

function shuffle(a){
 for(let i=a.length-1;i>0;i--){
  const j=Math.floor(Math.random()*(i+1));
  [a[i],a[j]]=[a[j],a[i]];
 }
 return a;
}

class PhysicsController{
 constructor(el,cbs){
  this.el=el;this.cbs=cbs;this.start=null;
  el.onpointerdown=e=>this.start=e;
  el.onpointerup=e=>{
   if(!this.start)return;
   const dx=e.clientX-this.start.clientX;
   const dy=e.clientY-this.start.clientY;
   if(Math.hypot(dx,dy)>80)this.cbs(this.dir(dx,dy));
   this.start=null;
  };
 }
 dir(dx,dy){
  const a=Math.atan2(-dy,dx)*180/Math.PI;
  if(a>45&&a<135)return"UP";
  if(a>135||a<-135)return"LEFT";
  if(a<-45&&a>-135)return"DOWN";
  return"RIGHT";
 }
}

function card(text,labels,cb){
 stack.innerHTML="";
 const el=document.createElement("div");
 el.className="card";
 el.innerHTML=`
  <div class="card-q">${text}</div>
  <div class="swipe-label">${labels.up||""}</div>
 `;
 stack.appendChild(el);
 requestAnimationFrame(()=>el.querySelector(".card-q").classList.add("show"));
 new PhysicsController(el,cb);
}

/* ===== NEW LAYER ===== */
function volumeLayer(){
 card("QUESTION VOLUME",{
  up:"10 QUESTIONS",
  left:"25 QUESTIONS",
  right:"50 QUESTIONS",
  down:"100 QUESTIONS"
 },dir=>{
  if(dir==="UP")QUESTION_LIMIT=10;
  if(dir==="LEFT")QUESTION_LIMIT=25;
  if(dir==="RIGHT")QUESTION_LIMIT=50;
  if(dir==="DOWN")QUESTION_LIMIT=100;
  startQuiz();
 });
}

/* ===== QUIZ UNCHANGED ===== */
function startQuiz(){
 POOL=shuffle([...RAW_DATA]);
 if(QUESTION_LIMIT) POOL=POOL.slice(0,QUESTION_LIMIT);
 WRONG=[];SESSION_ALL=[];XP=0;
 nextQuiz();
}
function nextQuiz(){
 if(!POOL.length){scoreCard();return;}
 CURR=POOL.shift();SESSION_ALL.push(CURR);
 const opts=shuffle([CURR.u,CURR.l,CURR.r]);
 card(CURR.q,{up:opts[0]},()=>nextQuiz());
}
function scoreCard(){
 card(`DONE\n${XP}/${SESSION_ALL.length}`,{up:"RETRY"},()=>volumeLayer());
}

/* ===== INIT ===== */
(function(){
 RAW_DATA=JSON.parse(localStorage.getItem(MASTER_KEY)||"[]");
 card("BEGIN SESSION",{up:"QUIZ"},()=>volumeLayer());
})();
</script>
</body>
</html>
