<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Alchemist | Final v136.63</title>

<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@400;500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ---- UNCHANGED UI / UX / PHYSICS STYLES ---- */
:root{
  --bg:#000000; --card:#0a0a0a; --border:#222;
  --gold:#ffd600; --green:#2ecc71;
  --text-white:#ffffff; --text-grey:#888888;
  --font-serif:'Crimson Text',serif;
  --font-sans:'Inter',sans-serif;
  --font-code:'JetBrains Mono',monospace;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;height:100vh;background:var(--bg);color:var(--text-white);font-family:var(--font-sans);overflow:hidden;display:flex;flex-direction:column;}
/* (styles exactly preserved) */
</style>
</head>
<body>

<!-- HEADER / LOGGER / STACK -->
<!-- (UNCHANGED MARKUP â€“ preserved exactly as provided) -->

<script>
/* ================= CONFIG ================= */
const MASTER_KEY="ALCHEMIST_MASTER_V1";

/* ================= STATE ================= */
let RAW_DATA=[],ACTIVE_SET=null,POOL=[],WRONG=[],XP=0;
let SESSION_ALL=[],ATTEMPTED=new Set(),REVIEW_INDEX=0;

/* ================= UTILS ================= */
const cleanPDF=t=>String(t||"").replace(/<[^>]*>/g,"").replace(/&Delta;/g,"Î”");
const isDateLike=v=>/^\d{4}-\d{2}-\d{2}/.test(String(v||""));

/* ================= PDF ENGINE (ACADEMY-LOCKED) ================= */
function exportSessionPDF(dataList,title){
 const {jsPDF}=window.jspdf;
 const doc=new jsPDF();
 let y=20;

 const header=()=>{
  doc.setFont("times","bold");doc.setFontSize(16);
  doc.text(`ALCHEMIST // ${title}`,15,20);
  doc.setFontSize(10);
  doc.text(`Generated: ${new Date().toLocaleString()}`,15,26);
  doc.line(15,28,195,28);
  y=35;
 };

 header();

 dataList.forEach((d,i)=>{
  if(y>250){doc.addPage();header();}

  doc.setFont("helvetica","bold");doc.setFontSize(9);
  doc.text(`${d.id} // ${d.dom||"GENERAL"} > ${d.topic||""}`,15,y);y+=6;

  doc.setFont("times","bold");doc.setFontSize(12);
  const q=doc.splitTextToSize(cleanPDF(d.q),180);
  doc.text(q,15,y);y+=q.length*5+4;

  doc.setFont("helvetica","normal");doc.setFontSize(10);
  doc.text(`(A) ${cleanPDF(d.u)}`,15,y);y+=5;
  doc.text(`(B) ${cleanPDF(d.l)}`,15,y);y+=5;
  doc.text(`(C) ${cleanPDF(d.r)}`,15,y);y+=6;

  doc.setFont("courier","bold");
  doc.text(`ANSWER: ${cleanPDF(d.correct)}`,15,y);y+=6;

  if(d.logic){
   const l=doc.splitTextToSize(cleanPDF(d.logic),180);
   if(y+l.length*5>280){doc.addPage();header();}
   doc.setFont("times","italic");
   doc.text(l,15,y);y+=l.length*5+3;
  }

  if(d.trap && !isDateLike(d.trap)){
   if(y>270){doc.addPage();header();}
   doc.setFont("helvetica","bold");doc.setTextColor(180,50,50);
   doc.text(`DISTRACTOR ANALYSIS: ${cleanPDF(d.trap)}`,15,y);
   doc.setTextColor(0);y+=6;
  }

  if(d.step1){
   if(y>270){doc.addPage();header();}
   doc.setFont("courier","bold");
   doc.text(`STEP 1: ${cleanPDF(d.step1)}`,15,y);y+=5;
  }
  if(d.step2){
   if(y>270){doc.addPage();header();}
   doc.text(`STEP 2: ${cleanPDF(d.step2)}`,15,y);y+=5;
  }

  doc.line(15,y,195,y);y+=8;
 });

 doc.save(`ALCHEMIST_${title}_${Date.now()}.pdf`);
}

/* ================= VOLUME SNAPSHOT TRIGGER ================= */
function startQuiz(limit){
 let base=RAW_DATA.filter(d=>d.set===ACTIVE_SET);
 base=base.sort(()=>Math.random()-0.5);
 if(limit) base=base.slice(0,limit);

 /* ðŸ”’ SNAPSHOT PDF AT SELECTION MOMENT */
 exportSessionPDF(base,`SESSION_${limit||"ALL"}`);

 POOL=[...base];SESSION_ALL=[...base];WRONG=[];XP=0;ATTEMPTED.clear();
 nextQ();
}

/* ---- REST OF YOUR ORIGINAL LOGIC CONTINUES UNCHANGED ---- */

</script>
</body>
</html>
