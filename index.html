<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>Alchemist | Operator v136.36</title>

<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#000;--card:#121212;--border:#333;
 --gold:#d4af37;--text:#ccc;
 --serif:'Crimson Text',serif;
 --sans:'Inter',sans-serif;
 --mono:'JetBrains Mono',monospace;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
 margin:0;height:100vh;background:var(--bg);color:var(--text);
 font-family:var(--sans);overflow:hidden;display:flex;flex-direction:column
}
#header{width:90%;margin:22px auto 0}
.header-meta{
 display:flex;justify-content:space-between;
 font-family:var(--mono);font-size:.75rem;color:#666;
 letter-spacing:1.5px;text-transform:uppercase
}
#review-text{
 margin-top:14px;font-family:var(--serif);
 font-size:1.2rem;font-style:italic;
 text-align:center;color:var(--gold);min-height:3em
}
.progress-track{width:100%;height:3px;background:#222;margin-top:12px}
#progress-bar{height:100%;background:var(--gold);width:0%}
#stack{
 position:relative;width:90%;max-width:420px;height:62vh;
 margin:auto;perspective:1500px;
 display:flex;align-items:center;justify-content:center
}
.card{
 position:absolute;width:100%;height:95%;
 background:var(--card);border-radius:14px;
 border:1px solid var(--border);
 padding:36px;display:flex;align-items:center;justify-content:center;
 box-shadow:0 20px 60px rgba(0,0,0,.95);
 transform-style:preserve-3d;overflow:hidden
}
.card-q{
 font-family:var(--serif);
 font-size:clamp(1.15rem,4vw,1.75rem);
 line-height:1.55;font-weight:600;
 text-align:center;color:var(--text);
 width:100%;max-height:100%;
 overflow-y:auto;padding:0 6px
}
.swipe-label{
 position:absolute;inset:0;display:flex;
 align-items:center;justify-content:center;
 background:#000;font-weight:800;
 font-size:1.4rem;letter-spacing:1px;
 opacity:0;pointer-events:none;
 border-radius:14px;border:1px solid #333
}
</style>
</head>

<body>

<div id="header">
 <div class="header-meta">
  <span id="id-ui">BOOT</span>
  <span id="xp-ui">0 XP</span>
 </div>
 <div id="review-text"></div>
 <div class="progress-track"><div id="progress-bar"></div></div>
</div>

<div id="stack"></div>

<script>
/* ================= CONFIG ================= */
const MASTER_KEY="ALCHEMIST_MASTER_V1";

/* ================= STATE ================= */
let RAW_DATA=[],POOL=[],XP=0;

/* ================= UI ================= */
const UI={
 stack:document.getElementById("stack"),
 id:document.getElementById("id-ui"),
 xp:document.getElementById("xp-ui"),
 bar:document.getElementById("progress-bar"),
 review:document.getElementById("review-text")
};

/* ================= UTILS ================= */
function chem(t){
 if(!t)return"";
 return String(t)
  .replace(/_([0-9]+)/g,"<sub>$1</sub>")
  .replace(/\^([0-9+\-]+)/g,"<sup>$1</sup>");
}
function shuffle(a){
 for(let i=a.length-1;i>0;i--){
  const j=Math.floor(Math.random()*(i+1));
  [a[i],a[j]]=[a[j],a[i]];
 }
 return a;
}

/* ================= PHYSICS ================= */
class Physics{
 constructor(el,cb){
  this.el=el;this.cb=cb;this.active=false;this.s={x:0,y:0};
  this.labels={
   UP:el.querySelector(".sl-up"),
   LEFT:el.querySelector(".sl-left"),
   RIGHT:el.querySelector(".sl-right"),
   DOWN:el.querySelector(".sl-down")
  };
  const s=e=>this.start(e.touches?e.touches[0]:e);
  const m=e=>this.move(e.touches?e.touches[0]:e);
  const e2=()=>this.end();
  el.addEventListener("mousedown",s);
  window.addEventListener("mousemove",m);
  window.addEventListener("mouseup",e2);
  el.addEventListener("touchstart",s,{passive:false});
  el.addEventListener("touchmove",e=>{if(this.active)e.preventDefault();m(e)},{passive:false});
  el.addEventListener("touchend",e2);
 }
 start(p){this.active=true;this.s={x:p.clientX,y:p.clientY};this.el.style.transition="none"}
 move(p){
  if(!this.active)return;
  const dx=p.clientX-this.s.x,dy=p.clientY-this.s.y;
  const d=Math.hypot(dx,dy);
  this.el.style.transform=`translate(${dx}px,${dy}px) rotate(${dx/20}deg)`;
  Object.values(this.labels).forEach(l=>l&&(l.style.opacity=0));
  if(d>25){
   const dir=this.dir(dx,dy);
   this.labels[dir]&&(this.labels[dir].style.opacity=Math.min(d/60,1));
  }
 }
 end(){
  if(!this.active)return;
  this.active=false;
  const m=new WebKitCSSMatrix(getComputedStyle(this.el).transform);
  const dx=m.m41,dy=m.m42;
  if(Math.hypot(dx,dy)>110)this.cb(this.dir(dx,dy));
  else{this.el.style.transition=".35s ease";this.el.style.transform="translate(0,0)"}
 }
 dir(dx,dy){
  const a=(Math.atan2(-dy,dx)*180/Math.PI+360)%360;
  if(a>45&&a<135)return"UP";
  if(a>135&&a<225)return"LEFT";
  if(a>225&&a<315)return"DOWN";
  return"RIGHT";
 }
}

/* ================= CARD ================= */
function card(text,labels,cb){
 UI.stack.innerHTML="";
 const el=document.createElement("div");
 el.className="card";
 el.innerHTML=`
  <div class="card-q">${chem(text).replace(/\n/g,"<br>")}</div>
  <div class="swipe-label sl-up">${labels.up||""}</div>
  <div class="swipe-label sl-left">${labels.left||""}</div>
  <div class="swipe-label sl-right">${labels.right||""}</div>
  <div class="swipe-label sl-down">${labels.down||""}</div>
 `;
 UI.stack.appendChild(el);
 new Physics(el,cb);
}

/* ================= FLOW ================= */
function begin(){
 card(
  `SESSION READY\n${RAW_DATA.length} Questions Loaded`,
  {up:"START"},
  ()=>startQuiz()
 );
}

function startQuiz(){
 POOL=shuffle([...RAW_DATA]);
 XP=0;
 nextQ();
}

function nextQ(){
 if(!POOL.length){
  card(`DONE\n${XP} XP`,{up:"RESTART"},()=>begin());
  return;
 }
 const d=POOL.shift();
 UI.id.textContent=d.id;
 const opts=shuffle([d.u,d.l,d.r]);
 const map={UP:opts[0],LEFT:opts[1],RIGHT:opts[2]};
 card(
  d.q,
  {up:map.UP,left:map.LEFT,right:map.RIGHT},
  dir=>{
   if(map[dir]===d.correct)XP++;
   UI.xp.textContent=`${XP} XP`;
   nextQ();
  }
 );
}

/* ================= INIT (ADMIN DATA ONLY) ================= */
(function init(){
 let raw=null;
 try{
  raw=JSON.parse(localStorage.getItem(MASTER_KEY)||"null");
 }catch(e){}
 if(!Array.isArray(raw)||!raw.length){
  card("NO DATA FOUND\nLoad data using Admin",{},()=>{});
  return;
 }
 RAW_DATA=raw.map(d=>{
  let c=d.correct;
  if(c==="OPT_A")c=d.u;
  if(c==="OPT_B")c=d.l;
  if(c==="OPT_C")c=d.r;
  return {...d,correct:c};
 });
 begin();
})();
</script>

</body>
</html>
