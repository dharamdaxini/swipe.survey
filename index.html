<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Alchemist | Kinetic v145.0</title>

<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600&family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">

<style>
/* --- CORE & METALLIC THEME --- */
:root{ --bg:#000; --card:#0a0a0a; --border:#222; --gold:#ffd600; --silver:#c0c0c0; --font-code:'JetBrains Mono',monospace; }
*{box-sizing:border-box; -webkit-tap-highlight-color:transparent; user-select: none;}
body{margin:0; height:100vh; background:var(--bg); color:#fff; font-family:'Inter',sans-serif; overflow:hidden; display:flex; flex-direction:column;}

/* --- HEADER & XP ROW --- */
#header{width:90%; margin:25px auto 0; z-index:100;}
.xp-row{display:flex; justify-content:space-between; font-family:var(--font-code); font-size:0.85rem; color:#666; text-transform:uppercase;}
#progress-bar{height:2px; background:var(--gold); width:0%; transition:width 0.4s ease; margin-top:10px;}
.track{width:100%; height:2px; background:#1a1a1a; margin-top:2px;}

/* --- BIG HUD GRID (35/70/80 Opacity) --- */
#hud-grid { display: grid; grid-template-columns: 1fr 1fr; width: 90%; margin: 20px auto 5px; font-family: var(--font-code); font-size: 0.75rem; line-height: 1.8; }
.hud-right { text-align: right; }
.h1 { opacity: 0.35; } .h2 { opacity: 0.70; } .h3 { opacity: 0.80; color: var(--silver); }

/* --- RESERVED LIVE LOG --- */
#live-log { width: 90%; margin: 5px auto; font-family: var(--font-code); font-size: 0.7rem; color: #444; }
#live-log .active { color: var(--gold); }

/* --- GHOST LAYER (BEHIND CARDS) --- */
#ghost-layer { position: absolute; inset: 0; top: 220px; width: 85%; margin: 0 auto; display: flex; justify-content: space-between; z-index: 5; opacity: 0; transition: opacity 0.2s; }
.ghost-text { width: 45%; font-family: var(--font-code); font-size: 0.7rem; color: var(--silver); line-height: 1.5; }

/* --- STACK & PHYSICS (v144.2 Restored) --- */
.stack-container{position:absolute; inset:0; top:155px; width:92%; max-width:440px; height:calc(100vh - 280px); margin:0 auto; perspective:1200px; z-index: 20;}
.card{position:absolute; width:100%; height:100%; background:var(--card); border-radius:20px; border:1px solid var(--border); padding:40px; display:flex; flex-direction:column; justify-content:center; align-items:center; box-shadow:0 20px 60px rgba(0,0,0,0.95); will-change:transform;}
.card-q{font-family:'Crimson Text',serif; font-size:1.7rem; text-align:center; color: #fff; line-height: 1.4;}
.swipe-label{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:#000; font-weight:900; font-size:1.6rem; text-transform:uppercase; opacity:0; transition:opacity 0.15s; border-radius:20px; color:var(--silver); text-align: center; border: 1px solid #333;}
</style>
</head>
<body>

<div id="header">
  <div class="xp-row"><span>KINETIC.v145</span><span id="xp-ui">0 XP</span></div>
  <div id="progress-bar"></div><div class="track"></div>
</div>

<div id="hud-grid">
    <div class="hud-col"><div class="h1" id="l1">[ ONLINE ]</div><div class="h2" id="l2">[ FUEL: 10.0 ]</div><div class="h3" id="l3">[ DUMP: 0/20 ]</div></div>
    <div class="hud-col hud-right"><div class="h1" id="r1">00 / 00</div><div class="h2" id="r2">DATABASE</div><div class="h3" id="r3">SUB TOPIC</div></div>
</div>

<div id="live-log"><span class="active">> SYSTEM READY</span></div>

<div id="ghost-layer">
    <div class="ghost-text" id="g-law">CORE LAW: N/A</div>
    <div class="ghost-text" style="text-align:right" id="g-hint">HINT: N/A</div>
</div>

<div id="stack-game" class="stack-container"></div>

<script>
// --- CORE ENGINE ---
const BEACON_URL = "YOUR_APPS_SCRIPT_URL"; // Deploy Apps Script as Web App
let RAW_DATA=[], POOL=[], SESSION_ALL=[], XP=0, VOL=10, Q_IDX=0;
let CREDITS = parseFloat(localStorage.getItem("K1_CREDITS") || "10");
let DUMPS = parseInt(localStorage.getItem("K1_DUMPS") || "0");
let VAULT = JSON.parse(localStorage.getItem("K1_VAULT") || "[]");

class Physics {
    constructor(el, cb) {
        this.el = el; this.cb = cb; this.active = false; this.start = {x:0, y:0};
        this.ghost = document.getElementById('ghost-layer');
        const s = e => this.dragStart(e.touches ? e.touches[0] : e);
        const m = e => this.dragMove(e.touches ? e.touches[0] : e);
        const e2 = () => this.dragEnd();
        el.addEventListener('mousedown', s); window.addEventListener('mousemove', m); window.addEventListener('mouseup', e2);
        el.addEventListener('touchstart', s); el.addEventListener('touchmove', ev => {if(this.active) ev.preventDefault(); this.dragMove(ev.touches[0])}, {passive:false}); el.addEventListener('touchend', e2);
    }
    dragStart(p) { this.active = true; this.start = {x:p.clientX, y:p.clientY}; this.el.style.transition = "none"; }
    dragMove(p) {
        if(!this.active) return;
        const dx = p.clientX - this.start.x, dy = p.clientY - this.start.y;
        this.el.style.transform = `translate(${dx}px, ${dy}px) rotate(${dx/22}deg)`;
        if(dy > 50) this.ghost.style.opacity = Math.min((dy-50)/100, 1);
        else this.ghost.style.opacity = 0;
        const d = Math.hypot(dx, dy);
        const ls = {UP:this.el.querySelector('.sl-up'), LEFT:this.el.querySelector('.sl-left'), RIGHT:this.el.querySelector('.sl-right')};
        Object.values(ls).forEach(l => {if(l) l.style.opacity = 0;});
        if(d > 40) {
            const dir = this.getDir(dx, dy);
            if(ls[dir]) ls[dir].style.opacity = Math.min(d/120, 0.5);
        }
    }
    dragEnd() {
        if(!this.active) return; this.active = false;
        this.ghost.style.opacity = 0;
        const m = new WebKitCSSMatrix(getComputedStyle(this.el).transform);
        if(Math.hypot(m.m41, m.m42) > 115) this.cb(this.getDir(m.m41, m.m42));
        else { this.el.style.transition = "0.4s cubic-bezier(0.2, 0.8, 0.2, 1)"; this.el.style.transform = "translate(0,0)"; }
    }
    getDir(x,y){
        const a=(Math.atan2(-y,x)*180/Math.PI+360)%360;
        if(a>45&&a<135)return "UP"; if(a>135&&a<225)return "LEFT"; return "RIGHT";
    }
}

function updateLiveLog(msg) {
    document.getElementById('live-log').innerHTML = `<span class="active">> ${msg}</span>`;
}

function render(d) {
    const cont = document.getElementById('stack-game');
    cont.innerHTML = '';
    const el = document.createElement('div'); el.className = 'card';
    el.innerHTML = `<div class="card-q">${d.q}</div>
                    <div class="swipe-label sl-up">${d.u}</div>
                    <div class="swipe-label sl-left">${d.l}</div>
                    <div class="swipe-label sl-right">${d.r}</div>`;
    
    document.getElementById('r1').innerText = `${Q_IDX.toString().padStart(2,'0')} / ${VOL}`;
    document.getElementById('r2').innerText = d.dom || "CHEMISTRY";
    document.getElementById('r3').innerText = d.sub || d.topic || "THEORY";
    
    const lawMatch = (d.logic || "").match(/\b\w+ Law\b/i);
    document.getElementById('g-law').innerText = lawMatch ? `CORE LAW: ${lawMatch[0].toUpperCase()}` : "CORE LAW: FUNDAMENTAL";
    document.getElementById('g-hint').innerText = `HINT: ${d.hint || "CHECK THE COLLIGATIVE PROPERTY"}`;
    
    cont.appendChild(el);
    new Physics(el, (dir) => { 
        Q_IDX++; 
        if(Q_IDX <= VOL) updateLiveLog(`ID: ${d.id}`);
        next(); 
    });
}

function next() {
    if(POOL.length > 0) render(POOL.shift());
}

async function init() {
    try { const r = await fetch('master.json'); if(r.ok) RAW_DATA = await r.json(); } catch(e){}
    if(RAW_DATA.length) {
        POOL = RAW_DATA.slice(0, VOL);
        updateLiveLog("INITIATING QUIZ...");
        next();
    }
}
init();
</script>
</body>
</html>
