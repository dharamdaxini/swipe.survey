<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Survey</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: fixed;
  background: #ffffff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  touch-action: pan-y;
}

#app {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.container {
  max-width: 500px;
  width: 100%;
  text-align: center;
}

.question-card {
  background: #ffffff;
  padding: 40px 30px;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
}

.question-text {
  font-size: 28px;
  font-weight: 600;
  color: #1a1a1a;
  margin-bottom: 20px;
  line-height: 1.4;
}

.instruction {
  font-size: 14px;
  color: #666;
  margin-bottom: 30px;
}

.swipe-indicators {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 30px;
  font-size: 48px;
  color: #999;
  user-select: none;
  margin-top: 20px;
}

.swipe-legend {
  font-size: 13px;
  color: #888;
  margin-top: 25px;
  line-height: 1.6;
}

.done-screen {
  display: none;
  font-size: 32px;
  font-weight: 600;
  color: #1a1a1a;
}

.done-screen.active {
  display: block;
}

.question-card.hidden {
  display: none;
}

@media (max-width: 480px) {
  .question-text {
    font-size: 24px;
  }
  
  .swipe-indicators {
    font-size: 40px;
    gap: 20px;
  }
}
</style>
</head>
<body>
<div id="app">
  <div class="container">
    <div id="questionCard" class="question-card">
      <div class="question-text" id="questionText"></div>
      <div class="instruction">Swipe to answer</div>
      <div class="swipe-indicators">
        <span>↑</span>
        <span>→</span>
        <span>↓</span>
        <span>←</span>
      </div>
      <div class="swipe-legend">
        ↑ Slight improvement  •  → Moderate improvement  •  ↓ Major improvement  •  ← No noticeable change
      </div>
    </div>
    <div id="doneScreen" class="done-screen">
      Saved. Thank you.
    </div>
  </div>
</div>

<script>
const APPS_SCRIPT_URL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgnpoB9YiIqTV3iCCPvekHTS1_C4Tgr5fhOAKpXsUpvqUH8i9PrfgANdPFE5wz42pk6xGq2J73v-USzHEm4uOXl4KyOUQS6ms7JqlDceiTbtzojrzT9SkK7R4-hwK1jv9aLf5MxH0Le5V8c6kx-v0rHUFGtR55yDC1shutFk12m_vIwheUW3ObGTmlWbxfESOf4dZNawF_F5APsRBzS6f1_p5PcqvhToqe6KE9vkNc_0bvLFzp5jcvTyU7JpxxwiNVuPzVAPKGdu1XBsBcQ_K0keehxPWb_Ev8D4TmR&lib=MUqFmX3xhxFDzBtrCsRU7H_m8FswXrvlL';

const SESSION_ID = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

const STATE = {
  current: 'Q1',
  q1Response: null
};

const QUESTIONS = {
  Q1: 'How has your condition changed since starting treatment?',
  Q2_IMPROVED: 'What helped the most?',
  Q2_WORSE: 'What made it worse?',
  Q2_NO_CHANGE: 'Why no change?'
};

const SWIPE_LABELS = {
  up: 'Slight improvement',
  right: 'Moderate improvement',
  down: 'Major improvement',
  left: 'No noticeable change'
};

let touchStartX = 0;
let touchStartY = 0;
let touchEndX = 0;
let touchEndY = 0;

function init() {
  showQuestion('Q1', QUESTIONS.Q1);
  document.getElementById('questionCard').addEventListener('touchstart', handleTouchStart, { passive: true });
  document.getElementById('questionCard').addEventListener('touchend', handleTouchEnd, { passive: true });
}

function handleTouchStart(e) {
  touchStartX = e.changedTouches[0].screenX;
  touchStartY = e.changedTouches[0].screenY;
}

function handleTouchEnd(e) {
  touchEndX = e.changedTouches[0].screenX;
  touchEndY = e.changedTouches[0].screenY;
  handleSwipe();
}

function handleSwipe() {
  const deltaX = touchEndX - touchStartX;
  const deltaY = touchEndY - touchStartY;
  const absDeltaX = Math.abs(deltaX);
  const absDeltaY = Math.abs(deltaY);
  
  const THRESHOLD = 50;
  
  if (absDeltaX < THRESHOLD && absDeltaY < THRESHOLD) {
    return;
  }
  
  let direction = null;
  
  if (absDeltaX > absDeltaY) {
    direction = deltaX > 0 ? 'right' : 'left';
  } else {
    direction = deltaY > 0 ? 'down' : 'up';
  }
  
  if (direction) {
    handleAnswer(direction);
  }
}

function handleAnswer(direction) {
  if (STATE.current === 'Q1') {
    STATE.q1Response = direction;
    logResponse('Q1', direction);
    
    let nextQuestion = '';
    if (direction === 'up' || direction === 'right') {
      nextQuestion = QUESTIONS.Q2_IMPROVED;
    } else if (direction === 'down') {
      nextQuestion = QUESTIONS.Q2_WORSE;
    } else if (direction === 'left') {
      nextQuestion = QUESTIONS.Q2_NO_CHANGE;
    }
    
    STATE.current = 'Q2';
    showQuestion('Q2', nextQuestion);
    
  } else if (STATE.current === 'Q2') {
    logResponse('Q2', direction);
    STATE.current = 'DONE';
    showDone();
  }
}

function showQuestion(questionId, questionText) {
  document.getElementById('questionText').textContent = questionText;
}

function showDone() {
  document.getElementById('questionCard').classList.add('hidden');
  document.getElementById('doneScreen').classList.add('active');
}

function logResponse(questionId, direction) {
  const payload = {
    timestamp: new Date().toISOString(),
    question_id: questionId,
    swipe_direction: direction,
    derived_label: SWIPE_LABELS[direction] || direction,
    session_id: SESSION_ID
  };
  
  fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(payload)
  }).catch(err => {
    console.error('Logging failed:', err);
  });
}

init();
</script>
</body>
</html>
