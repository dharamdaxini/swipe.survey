<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>Alchemist | Operator v136.36</title>

<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@400;500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#000;--card:#121212;--border:#333;
 --gold:#d4af37;--text:#ccc;
 --font-serif:'Crimson Text',serif;
 --font-sans:'Inter',sans-serif;
 --font-code:'JetBrains Mono',monospace;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
 margin:0;height:100vh;background:var(--bg);color:var(--text);
 font-family:var(--font-sans);overflow:hidden;display:flex;flex-direction:column
}
#header{width:90%;margin:25px auto 0}
.header-meta{
 display:flex;justify-content:space-between;
 font-family:var(--font-code);font-size:.75rem;color:#666;letter-spacing:1.5px
}
#review-text{
 margin-top:20px;font-family:var(--font-serif);
 font-size:1.2rem;font-style:italic;text-align:center;
 color:var(--gold);min-height:3em
}
.progress-track{width:100%;height:3px;background:#222;margin-top:15px}
#progress-bar{height:100%;background:var(--gold);width:0%;transition:.3s}

#stack{
 position:relative;width:90%;max-width:420px;height:62vh;
 margin:auto;display:flex;align-items:center;justify-content:center
}
.card{
 position:absolute;width:100%;height:95%;
 background:var(--card);border-radius:12px;border:1px solid var(--border);
 padding:35px;display:flex;justify-content:center;align-items:center;
 box-shadow:0 20px 60px rgba(0,0,0,.9);will-change:transform
}
.card-q{
 font-family:var(--font-serif);
 font-size:clamp(1.1rem,4vw,1.6rem);
 text-align:center;line-height:1.5;overflow-y:auto;width:100%
}
.swipe-label{
 position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
 font-weight:800;font-size:1.4rem;opacity:0;pointer-events:none
}
.sl-up{color:#2ecc71}.sl-left{color:#ccc}
.sl-right{color:#ccc}.sl-down{color:#3498db}
</style>
</head>

<body>

<div id="header">
 <div class="header-meta">
  <span id="id-ui">BOOT</span>
  <span id="xp-ui">0 XP</span>
 </div>
 <div id="review-text"></div>
 <div class="progress-track"><div id="progress-bar"></div></div>
</div>

<div id="stack"></div>

<script>
/* ================= CONFIG ================= */
const MASTER_KEY = "ALCHEMIST_MASTER_V1";
const VAULT_VERSION = "v136.36";

/* ================= STATE ================= */
let RAW_DATA=[],POOL=[],WRONG=[],XP=0;
let SESSION_ALL=[],ATTEMPTED=new Set();

/* ================= UI ================= */
const UI={
 stack:document.getElementById("stack"),
 id:document.getElementById("id-ui"),
 xp:document.getElementById("xp-ui"),
 bar:document.getElementById("progress-bar"),
 review:document.getElementById("review-text")
};

/* ================= UTILS ================= */
const shuffle=a=>a.sort(()=>Math.random()-.5);

/* ================= CARD ================= */
function card(text,labels={},cb=()=>{}){
 UI.stack.innerHTML="";
 const el=document.createElement("div");
 el.className="card";
 el.innerHTML=`
  <div class="card-q">${text.replace(/\n/g,"<br>")}</div>
  <div class="swipe-label sl-up">${labels.up||""}</div>
  <div class="swipe-label sl-left">${labels.left||""}</div>
  <div class="swipe-label sl-right">${labels.right||""}</div>
  <div class="swipe-label sl-down">${labels.down||""}</div>
 `;
 UI.stack.appendChild(el);

 let sx,sy,dx,dy,drag=false;
 el.ontouchstart=e=>{drag=true;sx=e.touches[0].clientX;sy=e.touches[0].clientY};
 el.ontouchmove=e=>{
  if(!drag)return;
  dx=e.touches[0].clientX-sx;dy=e.touches[0].clientY-sy;
  el.style.transform=`translate(${dx}px,${dy}px)`;
 };
 el.ontouchend=()=>{
  drag=false;
  if(Math.hypot(dx,dy)>80){
   const dir=Math.abs(dx)>Math.abs(dy)
    ? dx>0?"RIGHT":"LEFT"
    : dy>0?"DOWN":"UP";
   cb(dir);
  }
  el.style.transform="";
 };
}

/* ================= FLOW ================= */
function begin(){
 card(
  `SESSION READY\n${RAW_DATA.length} Questions Loaded`,
  {up:"START"},
  d=>d==="UP"&&start()
 );
}

function start(){
 POOL=shuffle([...RAW_DATA]);
 XP=0;WRONG=[];SESSION_ALL=[];ATTEMPTED.clear();
 next();
}

function next(){
 UI.review.textContent="";
 if(!POOL.length){end();return;}
 const d=POOL.shift();
 UI.id.textContent=d.id;
 SESSION_ALL.push(d);

 const opts=shuffle([d.u,d.l,d.r]);
 const map={UP:opts[0],LEFT:opts[1],RIGHT:opts[2]};

 card(d.q,{
  up:map.UP,left:map.LEFT,right:map.RIGHT
 },dir=>{
  const pick=map[dir];
  if(pick!==d.correct)WRONG.push(d);
  else if(!ATTEMPTED.has(d.id))XP++;
  ATTEMPTED.add(d.id);
  UI.xp.textContent=`${XP}/${SESSION_ALL.length}`;
  UI.bar.style.width=(SESSION_ALL.length/(SESSION_ALL.length+POOL.length))*100+"%";
  next();
 });
}

function end(){
 card(
  `DONE\n\n${XP}/${SESSION_ALL.length} Correct`,
  {up:"RESTART"},
  d=>d==="UP"&&begin()
 );
}

/* ================= FINAL INIT (LOCAL-ONLY, HARD STOP) ================= */
(function init(){
 let vault;
 try{vault=JSON.parse(localStorage.getItem(MASTER_KEY)||"null");}
 catch{vault=null;}

 if(!vault||vault.__vault_version!==VAULT_VERSION||!Array.isArray(vault.data)){
  card(
   "NO VALID DATA\n\nPush TSV from Admin",
   {}
  );
  return;
 }

 RAW_DATA=vault.data.map(d=>{
  let c=d.correct;
  if(c==="OPT_A")c=d.u;
  if(c==="OPT_B")c=d.l;
  if(c==="OPT_C")c=d.r;
  return {...d,correct:c};
 }).filter(d=>d.id&&d.q&&d.u&&d.l&&d.r);

 begin();
})();
</script>

</body>
</html>
