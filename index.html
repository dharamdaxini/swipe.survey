<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Alchemist | Neural Backend</title>

<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,600;1,600&family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#000;--card:#111;--border:#222;
  --gold:#ffd600;--blue:#3498db;
  --green:#2ecc71;--red:#e74c3c;
  --font-chem:'Crimson Text',serif;
  --font-ui:'Inter',sans-serif;
  --font-code:'JetBrains Mono',monospace;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
  margin:0;height:100vh;background:var(--bg);
  color:#fff;font-family:var(--font-ui);
  overflow:hidden;display:flex;flex-direction:column;
}
#header{width:90%;margin:25px auto 0;z-index:100}
.header-meta{
  display:flex;justify-content:space-between;
  font-family:var(--font-code);font-size:.7rem;color:#555;letter-spacing:2px
}
.progress-track{width:100%;height:2px;background:#1a1a1a;margin-top:10px}
#progress-bar{height:100%;background:var(--gold);width:0%;transition:.4s}
#stack{
  position:relative;width:92%;max-width:400px;height:70vh;
  margin:auto;perspective:1200px;
  display:flex;align-items:center;justify-content:center
}
.card{
  position:absolute;width:100%;height:95%;
  background:var(--card);border-radius:40px;border:1px solid var(--border);
  padding:40px;display:flex;flex-direction:column;justify-content:center;
  box-shadow:0 30px 90px rgba(0,0,0,.9);will-change:transform
}
.card-q{
  font-family:var(--font-chem);
  font-size:1.7rem;line-height:1.4;
  font-style:italic;font-weight:600;text-align:center
}
.swipe-label{
  position:absolute;inset:0;display:flex;
  align-items:center;justify-content:center;
  background:#000;font-weight:900;font-size:1.8rem;
  text-transform:uppercase;border-radius:40px;
  opacity:0;pointer-events:none;padding:20px
}
.sl-up{color:var(--green)}
.sl-left,.sl-right{color:var(--red)}
.sl-down{color:var(--blue)}
</style>
</head>

<body>

<div id="header">
  <div class="header-meta">
    <span id="id-ui">ID: BOOT</span>
    <span id="xp-ui">0 XP</span>
  </div>
  <div class="progress-track"><div id="progress-bar"></div></div>
</div>

<div id="stack"></div>

<script>
/* ---------------- DATA ---------------- */
const RAW_DATA=[
 {id:"A1",set:"SET_A",q:"Electrode potential of Mg?",u:"2.71 V",l:"1.10 V",r:"2.03 V",correct:"2.71 V",logic:"Ecell = Ecathode − Eanode",step1:"Identify electrodes",step2:"Subtract potentials"},
 {id:"B1",set:"SET_B",q:"Alcohol → Aldehyde?",u:"PCC",l:"KMnO4",r:"H2SO4",correct:"PCC",logic:"Mild oxidation stops at aldehyde",step1:"Avoid strong oxidant",step2:"Use PCC"}
];

/* ---------------- STATE ---------------- */
const UI={
 stack:document.getElementById("stack"),
 id:document.getElementById("id-ui"),
 xp:document.getElementById("xp-ui"),
 bar:document.getElementById("progress-bar")
};

let SET_CURSOR=0, ACTIVE_SET=null;
let POOL=[], WRONG=[], REVIEW_INDEX=0;
let ATTEMPTED=[];
const sets=[...new Set(RAW_DATA.map(d=>d.set))];

/* ---------------- PHYSICS (UNCHANGED) ---------------- */
class PhysicsController{
 constructor(el,cbs){
  this.el=el;this.cbs=cbs;this.active=false;this.start={x:0,y:0};
  this.labels={
    UP:el.querySelector(".sl-up"),
    LEFT:el.querySelector(".sl-left"),
    RIGHT:el.querySelector(".sl-right"),
    DOWN:el.querySelector(".sl-down")
  };
  const s=e=>this.startDrag(e.touches?e.touches[0]:e);
  const m=e=>this.move(e.touches?e.touches[0]:e);
  const e2=()=>this.end();
  el.addEventListener("mousedown",s);
  window.addEventListener("mousemove",m);
  window.addEventListener("mouseup",e2);
  el.addEventListener("touchstart",s,{passive:false});
  el.addEventListener("touchmove",ev=>{if(this.active)ev.preventDefault();m(ev)},{passive:false});
  el.addEventListener("touchend",e2);
 }
 startDrag(p){this.active=true;this.start={x:p.clientX,y:p.clientY};this.el.style.transition="none"}
 move(p){
  if(!this.active)return;
  const dx=p.clientX-this.start.x,dy=p.clientY-this.start.y;
  const d=Math.hypot(dx,dy);
  this.el.style.transform=`translate(${dx}px,${dy}px) rotate(${dx/20}deg)`;
  Object.values(this.labels).forEach(l=>l&&(l.style.opacity=0));
  if(d>20){const dir=this.dir(dx,dy);this.labels[dir]&&(this.labels[dir].style.opacity=Math.min(d/50,1))}
 }
 end(){
  if(!this.active)return;this.active=false;
  const m=new WebKitCSSMatrix(getComputedStyle(this.el).transform);
  const dx=m.m41,dy=m.m42;
  if(Math.hypot(dx,dy)>100)this.cbs.onCommit(this.dir(dx,dy));
  else{this.el.style.transition=".4s";this.el.style.transform="translate(0,0)"}
 }
 dir(dx,dy){
  const a=(Math.atan2(-dy,dx)*180/Math.PI+360)%360;
  if(a>45&&a<135)return"UP";
  if(a>135&&a<225)return"LEFT";
  if(a>225&&a<315)return"DOWN";
  return"RIGHT";
 }
}

/* ---------------- CARD (FIXED) ---------------- */
function card(text,labels,cb){
 UI.stack.innerHTML="";
 const el=document.createElement("div");
 el.className="card";
 el.innerHTML=`
  <div class="card-q">${String(text || "").replace(/\n/g,"<br>")}</div>
  <div class="swipe-label sl-up">${labels.up||""}</div>
  <div class="swipe-label sl-left">${labels.left||""}</div>
  <div class="swipe-label sl-right">${labels.right||""}</div>
  <div class="swipe-label sl-down">${labels.down||""}</div>`;
 UI.stack.appendChild(el);
 new PhysicsController(el,{onCommit:cb});
}

/* ---------------- FLOW ---------------- */
function begin(){
 ATTEMPTED=[];
 card("BEGIN",{up:"QUIZ",down:"MY PDF",left:"RAPID",right:"LEARN"},dir=>{
  if(dir==="UP") setPick();
 });
}

/* --- rest unchanged --- */

begin();
</script>

</body>
</html>
