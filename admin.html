<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>VIA.STACK // ADMIN</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#000;--gold:#ffd600;--blue:#2979ff;--green:#00e676;
 --red:#ff4757;--border:#222
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
 margin:0;height:100vh;background:#000;color:#fff;
 font-family:Inter,sans-serif;overflow:hidden
}

/* FRONT */
#front{
 position:fixed;inset:0;display:flex;
 flex-direction:column;align-items:center;justify-content:center
}
.front-btn{
 width:260px;padding:18px;margin:10px 0;
 border-radius:60px;font-weight:900;
 border:2px solid var(--gold);
 background:rgba(0,0,0,.6);color:var(--gold)
}
.front-btn.ghost{border-color:#333;color:#555}

/* ADMIN */
#admin{
 position:fixed;inset:0;background:#050505;
 display:none;flex-direction:column;color:#ccc
}
header{
 padding:16px 22px;border-bottom:1px solid var(--border);
 display:flex;justify-content:space-between;align-items:center
}
.brand{font-weight:900;color:#fff}
.brand span{color:var(--gold)}
.exit{
 font-family:JetBrains Mono;font-size:.7rem;
 border:1px solid #333;padding:6px 14px;
 border-radius:20px;background:#000;color:#aaa
}
#scroll{flex:1;overflow-y:auto;padding-bottom:100px}

.zone{padding:28px;border-bottom:1px dashed #222}
.zone-title{font-size:.75rem;font-weight:900;color:#666;margin-bottom:14px}

/* Upload */
.upload-box{
 border:2px dashed #333;border-radius:20px;
 padding:40px 20px;text-align:center;
 font-family:JetBrains Mono;color:#777
}
.upload-box strong{color:#fff}
.upload-box span{display:block;margin-top:6px;font-size:.7rem;color:#555}

.btn{
 margin-top:18px;padding:16px 28px;
 border-radius:50px;font-weight:900;
 border:none;background:var(--gold);color:#000;width:100%
}

.terminal{
 margin-top:14px;background:#000;border:1px solid #222;
 border-radius:10px;padding:14px;
 font-family:JetBrains Mono;font-size:.7rem;
 color:#999;min-height:64px
}

.export-row{
 display:flex;gap:12px;margin-top:16px
}
.export-row button{
 flex:1;background:#111;color:#aaa;
 border:1px solid #222;border-radius:14px;
 padding:14px;font-weight:900
}
</style>
</head>

<body>

<!-- FRONT -->
<div id="front">
  <button class="front-btn ghost" onclick="openAdmin()">MANAGE VAULT</button>
</div>

<!-- ADMIN -->
<div id="admin">
<header>
  <div class="brand">VIA.<span>STACK</span> // ADMIN</div>
  <div class="exit" onclick="closeAdmin()">EXIT</div>
</header>

<div id="scroll">

  <!-- INGESTION -->
  <div class="zone">
    <div class="zone-title">01 // INGESTION ENGINE</div>

    <div class="upload-box" onclick="triggerUpload()">
      <strong>TAP TO UPLOAD FILE</strong>
      <span>TSV or JSON (Android Safe)</span>
    </div>

    <input id="fileInput" type="file" style="display:none">

    <button class="btn" onclick="alignData()">INITIATE ALIGNMENT</button>

    <div class="terminal" id="status">
      > SYSTEM STANDBY
    </div>
  </div>

  <!-- DEPLOY -->
  <div class="zone">
    <div class="zone-title">02 // DEPLOYMENT DOCK</div>
    <button class="btn" onclick="pushToIndex()">PUSH TO OPERATOR INDEX</button>
  </div>

  <!-- EXPORT -->
  <div class="zone">
    <div class="zone-title" style="color:var(--red)">03 // EXPORT & DANGER ZONE</div>
    <div class="export-row">
      <button onclick="exportJSON()">JSON</button>
      <button onclick="exportTSV()">TSV</button>
      <button onclick="purge()">PURGE</button>
    </div>
  </div>

</div>
</div>

<script>
const DB_KEY = "ALCHEMIST_DATA_V1";
let RAW_FILE = "";
let STAGED = [];

/* UI */
const status = m => document.getElementById("status").innerText = "> " + m;

/* Upload */
function triggerUpload(){
 const i=document.getElementById("fileInput");
 i.value=null;i.click();
}

document.getElementById("fileInput").addEventListener("change",e=>{
 const f=e.target.files[0];
 if(!f) return;
 const r=new FileReader();
 r.onload=ev=>{
   RAW_FILE=ev.target.result;
   status("FILE LOADED: " + f.name);
 };
 r.readAsText(f);
});

/* ALIGN */
function alignData(){
 if(!RAW_FILE) return status("NO FILE BUFFER");

 try{
   if(RAW_FILE.trim().startsWith("{") || RAW_FILE.trim().startsWith("[")){
     STAGED = JSON.parse(RAW_FILE);
     status("JSON PARSED: " + STAGED.length + " ROWS");
   } else {
     const rows = RAW_FILE.trim().split(/\r?\n/);
     STAGED = rows.slice(1).map(r=>{
       const c=r.split("\t");
       return {
         id:c[0],set:c[1],q:c[5],
         u:c[6],r:c[7],l:c[8],
         correct:c[9],logic:c[10],
         step1:c[22],step2:c[23]
       };
     });
     status("TSV PARSED: " + STAGED.length + " ROWS");
   }
 }catch(e){
   status("ALIGNMENT FAILED");
 }
}

/* PUSH */
function pushToIndex(){
 if(!STAGED.length) return status("NO DATA TO PUSH");
 localStorage.setItem(DB_KEY,JSON.stringify(STAGED));
 status("DATA PUSHED â†’ INDEX READY");
}

/* EXPORT */
function exportJSON(){
 if(!STAGED.length) return;
 const b=new Blob([JSON.stringify(STAGED,null,2)],{type:"application/json"});
 download(b,"master.json");
}
function exportTSV(){
 if(!STAGED.length) return;
 const rows=STAGED.map(o=>Object.values(o).join("\t")).join("\n");
 download(new Blob([rows]),"master.tsv");
}
function download(blob,name){
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);a.download=name;a.click();
}

/* DANGER */
function purge(){
 localStorage.clear();
 status("SYSTEM MEMORY PURGED");
}

/* NAV */
function openAdmin(){front.style.display="none";admin.style.display="flex"}
function closeAdmin(){admin.style.display="none";front.style.display="flex"}
</script>

</body>
</html>
