<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>VIA.STACK // ADMIN</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#000;--gold:#ffd600;--blue:#2979ff;--green:#00e676;
 --red:#ff4757;--border:#222
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
 margin:0;height:100vh;background:#000;color:#fff;
 font-family:Inter,sans-serif;overflow:hidden
}
header{
 padding:16px 22px;border-bottom:1px solid var(--border);
 display:flex;justify-content:space-between;align-items:center
}
.brand{font-weight:900}
.brand span{color:var(--gold)}
.back{
 font-family:'JetBrains Mono';font-size:.7rem;
 border:1px solid #333;padding:6px 14px;border-radius:20px;
 background:#000;color:#aaa
}
#wrap{height:calc(100vh - 60px);overflow-y:auto;padding:25px}

.zone{margin-bottom:40px}
.zone-title{
 font-size:.7rem;font-weight:900;
 color:#666;margin-bottom:14px
}

.upload-box{
 border:2px dashed #333;border-radius:22px;
 padding:40px 20px;text-align:center;
 color:#888;font-family:'JetBrains Mono'
}
.upload-box strong{color:#fff}
.upload-box span{display:block;margin-top:6px;font-size:.7rem;color:#666}

.btn{
 width:100%;margin-top:18px;
 padding:16px;border-radius:50px;
 border:none;font-weight:900;
 background:var(--gold);color:#000
}
.btn.red{background:var(--red);color:#fff}

.export-row{
 display:grid;grid-template-columns:repeat(3,1fr);
 gap:12px;margin-top:14px
}
.export-btn{
 padding:14px;border-radius:18px;
 background:#111;border:1px solid #222;
 color:#aaa;font-weight:800;
 font-size:.7rem;text-align:center
}

.terminal{
 margin-top:16px;background:#000;
 border:1px solid #222;border-radius:10px;
 padding:14px;font-family:'JetBrains Mono';
 font-size:.7rem;color:#666;white-space:pre-wrap
}
</style>
</head>

<body>

<header>
 <div class="brand">VIA.<span>STACK</span> // ADMIN</div>
 <div class="back" onclick="location.href='index.html'">EXIT</div>
</header>

<div id="wrap">

 <!-- INGEST -->
 <div class="zone">
  <div class="zone-title">01 // INGESTION ENGINE</div>

  <div class="upload-box" onclick="pickFile()">
   <strong>TAP TO UPLOAD FILE</strong>
   <span>JSON or TSV (Android Safe)</span>
  </div>

  <input id="file" type="file" hidden>

  <button class="btn" onclick="ingest()">INITIATE ALIGNMENT</button>
  <div class="terminal" id="log">> SYSTEM STANDBY</div>
 </div>

 <!-- DEPLOY -->
 <div class="zone">
  <div class="zone-title">02 // DEPLOYMENT DOCK</div>
  <button class="btn" onclick="push()">PUSH TO OPERATOR INDEX</button>
 </div>

 <!-- EXPORT -->
 <div class="zone">
  <div class="zone-title" style="color:var(--red)">03 // EXPORT & DANGER ZONE</div>

  <div class="export-row">
   <div class="export-btn" onclick="exportData('json')">JSON</div>
   <div class="export-btn" onclick="exportData('tsv')">TSV</div>
   <div class="export-btn" onclick="exportData('txt')">TXT</div>
  </div>

  <button class="btn red" onclick="purge()">PURGE SYSTEM MEMORY</button>
 </div>

</div>

<script>
/* ================= CONFIG ================= */
const STORAGE_KEY="ALCHEMIST_DATA_V1";
let STAGED=[];

/* ================= INGEST ================= */
function pickFile(){
 document.getElementById("file").value=null;
 document.getElementById("file").click();
}

function ingest(){
 const f=document.getElementById("file").files[0];
 if(!f){log("NO FILE SELECTED");return;}

 const r=new FileReader();
 r.onload=e=>{
  try{
   const txt=e.target.result;
   STAGED = f.name.endsWith(".json")
     ? JSON.parse(txt).filter(valid)
     : parseTSV(txt);

   log(`STAGED ${STAGED.length} VALID ROWS`);
  }catch{
   STAGED=[];
   log("PARSE ERROR");
  }
 };
 r.readAsText(f);
}

/* ================= PARSE ================= */
function parseTSV(txt){
 const rows=txt.trim().split(/\r?\n/);
 const start = rows[0].toLowerCase().includes("id") ? 1 : 0;

 return rows.slice(start).map(r=>{
  const c=r.split("\t");
  return{
   id:c[0]||"",
   set:c[1]||"SET_A",
   dom:c[2]||"MASTER",
   q:c[5]||"",
   u:c[6]||"",
   r:c[7]||"",
   l:c[8]||"",
   correct:c[9]||"",
   logic:c[10]||""
  };
 }).filter(valid);
}

function valid(r){
 return r.id && r.q && r.u && r.l && r.r && r.correct;
}

/* ================= DEPLOY ================= */
function push(){
 if(!STAGED.length){log("NO DATA STAGED");return;}
 localStorage.setItem(STORAGE_KEY,JSON.stringify(STAGED));
 log(`PUSHED ${STAGED.length} ROWS → INDEX`);
}

/* ================= EXPORT ================= */
function exportData(type){
 const data = STAGED.length
  ? STAGED
  : JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");

 if(!data.length){log("NO DATA TO EXPORT");return;}

 let out="",mime="text/plain",ext=type;

 if(type==="json"){
  out=JSON.stringify(data,null,2);
  mime="application/json";
 }
 if(type==="tsv"){
  out=data.map(r=>Object.values(r).join("\t")).join("\n");
 }
 if(type==="txt"){
  out=data.map(r=>`${r.id}\n${r.q}\nANS → ${r.correct}\n`).join("\n---\n");
 }

 const blob=new Blob([out],{type:mime});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download=`alchemist.${ext}`;
 a.click();
 URL.revokeObjectURL(a.href);

 log(`EXPORTED ${data.length} ROWS`);
}

/* ================= PURGE ================= */
function purge(){
 localStorage.removeItem(STORAGE_KEY);
 STAGED=[];
 log("STORAGE CLEARED");
}

/* ================= LOG ================= */
function log(m){
 document.getElementById("log").innerText="> "+m;
}
</script>

</body>
</html>
